<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TACTICAL_OS | UNIT 1654</title>
    
    <meta name="theme-color" content="#0d1109">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --army-bg: #0d1109; 
            --army-green: #4b5320; 
            --army-bright: #8a9a5b; 
            --hazard: #d2691e;
            --text: #c5c5c5;
            --font-main: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            margin: 0; background: var(--army-bg); color: var(--text);
            font-family: var(--font-main); font-weight: bold; overflow: hidden; text-transform: uppercase;
            height: 100vh;
        }

        /* Ефект CRT монітора */
        body::after {
            content: " "; position: fixed; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 10000;
        }

        #map { height: 100vh; width: 100%; filter: sepia(0.3) contrast(1.2) brightness(0.7); z-index: 1; }

        /* ВЕРХНЯ ПАНЕЛЬ */
        .status-header {
            position: fixed; top: 0; left: 0; right: 0; z-index: 2000;
            background: rgba(13, 17, 9, 0.95); border-bottom: 2px solid var(--army-green);
            padding: 8px 12px; display: flex; justify-content: space-between; align-items: center; 
            font-size: 10px; backdrop-filter: blur(5px);
        }

        .alert-indicator { display: flex; align-items: center; gap: 6px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }
        .dot-green { background: #00ff00; box-shadow: 0 0 5px #00ff00; }
        .dot-red { background: #ff0000; box-shadow: 0 0 10px #ff0000; animation: pulse 1s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* СПИСОК ЦІЛЕЙ */
        .tactical-list {
            position: fixed; right: 0; top: 45px; bottom: 100px; width: 300px;
            background: rgba(13, 17, 9, 0.9); border-left: 2px solid var(--army-green);
            z-index: 1500; padding: 10px; overflow-y: auto; scrollbar-width: none;
        }

        .target-card {
            border: 1px solid var(--army-green); background: rgba(0,0,0,0.5);
            margin-bottom: 8px; padding: 10px; cursor: pointer;
        }
        .target-card.active { border-left: 4px solid var(--hazard); background: rgba(210, 105, 30, 0.1); }

        /* МАРКЕРИ */
        .mil-icon-container { position: relative; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; }
        .mil-icon-frame { position: absolute; width: 30px; height: 30px; border: 2px solid var(--army-bright); transform: rotate(45deg); background: rgba(13,17,9,0.7); }
        .heading-vector { position: absolute; bottom: 50%; width: 2px; background: var(--hazard); transform-origin: bottom; }

        /* КНОПКА ТА ДИСКЛЕЙМЕР */
        .supply-btn {
            position: fixed; bottom: 30px; right: 10px; width: 280px; height: 50px;
            background: var(--army-green); color: #fff; border: 2px solid var(--army-bright);
            display:flex; align-items:center; justify-content:center; z-index:2001; 
            text-decoration:none; font-size: 11px;
        }

        .disclaimer-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(13, 17, 9, 1); color: var(--hazard);
            font-size: 8px; text-align: center; padding: 6px 5px;
            border-top: 1px solid var(--army-green); z-index: 3000; letter-spacing: 0.5px;
        }

        /* FAQ MODAL */
        #faq-modal {
            display: none; position: fixed; inset: 0; z-index: 5000;
            background: rgba(0,0,0,0.9); align-items: center; justify-content: center; padding: 20px;
        }
        .faq-content {
            background: var(--army-bg); border: 2px solid var(--army-green);
            width: 100%; max-width: 400px; padding: 20px;
        }

        /* АДАПТИВНІСТЬ ДЛЯ МОБІЛОК */
        @media (max-width: 768px) {
            #sys-title { display: none; } /* Ховаємо назву на користь індикаторів */
            .tactical-list { 
                width: 100%; height: 30vh; top: auto; bottom: 85px; 
                border-left: none; border-top: 2px solid var(--army-green); 
            }
            .supply-btn { width: calc(100% - 20px); left: 10px; bottom: 35px; }
            .status-header { padding: 8px 5px; font-size: 9px; }
        }
    </style>
</head>
<body>

<div class="status-header">
    <div id="sys-title">[ UNIT 1654 // KHARKIV ]</div>
    
    <div style="display:flex; gap:10px; align-items:center;">
        <div class="alert-indicator">
            <div id="alert-dot" class="dot dot-green"></div>
            <span id="alert-text">СИСТЕМА: НОРМА</span>
        </div>
        <div onclick="openFaq()" style="cursor:pointer; color:var(--army-bright); border:1px solid var(--army-green); padding:2px 5px;">[ FAQ ]</div>
        <div id="clock">00:00:00 Z</div>
    </div>
</div>

<div id="faq-modal" onclick="closeFaq()">
    <div class="faq-content" onclick="event.stopPropagation()">
        <h3 style="color:var(--army-bright); margin-top:0;">TACTICAL MANUAL</h3>
        <p style="font-size:11px; line-height:1.5;">
            • ВЕКТОР: НАПРЯМОК ТА ШВИДКІСТЬ ЦІЛІ.<br>
            • SPD: ШВИДКІСТЬ ОБ'ЄКТА (KM/H).<br>
            • ПОРАДА: НАТИСНІТЬ НА КАРТКУ ДЛЯ ФОКУСУ.
        </p>
        <button onclick="closeFaq()" style="width:100%; background:var(--army-green); color:white; border:none; padding:10px; font-family:inherit;">ПРИЙНЯТО</button>
    </div>
</div>

<div class="tactical-list" id="targetList"></div>

<a href="https://send.monobank.ua/jar/6R3gd9Ew8w" target="_blank" class="supply-btn">ДОПОМОГА ПРОЕКТУ [DONATE]</a>

<div class="disclaimer-bar">
    НЕ ОФІЦІЙНО. OSINT МОНІТОРИНГ. ПРИ ТРИВОЗІ — В УКРИТТЯ.
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const TacticalMath = {
        getDist: (p1, p2) => {
            const R = 6371;
            const dLat = (p2.lat - p1.lat) * Math.PI / 180;
            const dLon = (p2.lng - p1.lng) * Math.PI / 180;
            const a = Math.sin(dLat/2)**2 + Math.cos(p1.lat*Math.PI/180)*Math.cos(p2.lat*Math.PI/180)*Math.sin(dLon/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        },
        getBearing: (p1, p2) => {
            const y = Math.sin((p2.lng-p1.lng)*Math.PI/180) * Math.cos(p2.lat*Math.PI/180);
            const x = Math.cos(p1.lat*Math.PI/180)*Math.sin(p2.lat*Math.PI/180) - Math.sin(p1.lat*Math.PI/180)*Math.cos(p2.lat*Math.PI/180)*Math.cos((p2.lng-p1.lng)*Math.PI/180);
            return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
        }
    };

    function openFaq() { document.getElementById('faq-modal').style.display = 'flex'; }
    function closeFaq() { document.getElementById('faq-modal').style.display = 'none'; }

    async function checkAlerts() {
        const dot = document.getElementById('alert-dot');
        const text = document.getElementById('alert-text');
        try {
            const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://alerts.in.ua/api/states/14'));
            const data = await response.json();
            const status = JSON.parse(data.contents);
            if (status.state && status.state.alert) {
                dot.className = 'dot dot-red';
                text.innerText = 'ТРИВОГА';
                text.style.color = '#ff4444';
            } else {
                dot.className = 'dot dot-green';
                text.innerText = 'СИСТЕМА: НОРМА';
                text.style.color = 'var(--army-bright)';
            }
        } catch (e) { }
    }

    const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([49.99, 36.23], 9);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    let state = { targets: new Map(), layers: {} };

    async function syncTactical() {
        try {
            const res = await fetch('targets.json?v=' + Date.now());
            const data = await res.json();
            const list = document.getElementById('targetList');
            list.innerHTML = '';

            data.forEach(t => {
                const id = t.id.toString();
                const prev = state.targets.get(id);
                let speed = 0, bearing = 0;

                if (prev) {
                    speed = (TacticalMath.getDist(prev, t) * 3600) / 10;
                    bearing = TacticalMath.getBearing(prev, t);
                }

                state.targets.set(id, { ...t, speed, bearing });

                const card = document.createElement('div');
                card.className = `target-card ${t.status === 'active' ? 'active' : ''}`;
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; font-size:9px; color:var(--army-bright)">
                        <span>ID: ${id.slice(-4)} // ${t.type}</span>
                        <span>${speed.toFixed(0)} KM/H</span>
                    </div>
                    <div style="font-size:13px; margin: 4px 0; color:#fff;">${t.label.split('|')[0]}</div>
                `;
                card.onclick = () => map.flyTo([t.lat, t.lng], 10);
                list.appendChild(card);
                updateMarker(id, t, bearing, speed);
            });
        } catch (e) { }
    }

    function updateMarker(id, t, bearing, speed) {
        if (!state.layers[id]) {
            const icon = L.divIcon({
                className: '',
                html: `<div class="mil-icon-container">
                        <div class="heading-vector" style="height:${Math.min(speed/5, 40)}px; transform:rotate(${bearing}deg)"></div>
                        <div class="mil-icon-frame"></div>
                        <div style="position:absolute; font-size:7px; color:white; z-index:5;">${t.type[0]}</div>
                       </div>`,
                iconSize: [40, 40]
            });
            state.layers[id] = L.marker([t.lat, t.lng], { icon }).addTo(map);
        } else {
            state.layers[id].setLatLng([t.lat, t.lng]);
        }
    }

    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString() + ' Z';
    }, 1000);

    setInterval(syncTactical, 10000);
    setInterval(checkAlerts, 30000);
    syncTactical();
    checkAlerts();
</script>
</body>
</html>
